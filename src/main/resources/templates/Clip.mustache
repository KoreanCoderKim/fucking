<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>상세히 보기</title>
    <style>
        body {
            background-color: skyblue;
            width: auto;
            height: auto;
            color: greenyellow;
            text-shadow: 0.01cm 0.04cm green;
        }
        header {
            background-color: skyblue;
            width: auto;
            height: auto;
            color: burlywood;
        }
        h1 {
            text-shadow: 0.01cm 0.1cm rgb(182, 98, 38);
        }
        a {
            color: beige;
            text-decoration-line: none;
            text-shadow: 0.01cm 0.04cm black;
        }
    </style>
</head>
<body>
<header>
    <a href="https://port-0-fucking-m7oxoza4fc9682d2.sel4.cloudtype.app/Main">로그아웃</a><br>
    <h1>내용</h1>
    <h1>{{data}}</h1><br>
</header>

{{#data2}}
    <div style="display: flex; gap: 10px; flex-direction: column;">
        <p>{{usName}}의 메시지: {{commentValue}}</p>

        <button onclick="toggleReply('{{id}}')">대댓글 보기</button>
        
        <iframe 
            id="replyFrame-{{id}}" 
            src="https://port-0-fucking-m7oxoza4fc9682d2.sel4.cloudtype.app/Rep?AcceptId={{id}}" 
            width="100%" 
            style="border: none; display: none;" 
            scrolling="yes">
        </iframe>

        <a href="https://port-0-fucking-m7oxoza4fc9682d2.sel4.cloudtype.app/Reply?AcceptId={{id}}">대댓 달기 </a>
    </div>
{{/data2}}

<a href="https://port-0-fucking-m7oxoza4fc9682d2.sel4.cloudtype.app/Comment?articleId={{ID}}">댓글 달기 </a>

<script>
    // iframe 사이즈 조절
    window.addEventListener("message", (event) => {
        if (event.data.type === "resize" && event.data.height && event.data.id) {
            const frame = document.getElementById("replyFrame-" + event.data.id);
            if (frame) {
                frame.style.height = event.data.height + "px";
            }
        }
    });

    // 대댓글 iframe 보이기 토글 함수
    function toggleReply(id) {
        const iframe = document.getElementById("replyFrame-" + id);
        if (iframe.style.display === "none") {
            iframe.style.display = "block";
        } else {
            iframe.style.display = "none";
        }
    }

    // 세션 유지
    setInterval(() => {
        fetch('/session-ping', {
            method: 'POST',
            credentials: 'include'
        }).then(res => {
            if (res.ok) {
                console.log("세션 연장 성공");
            } else {
                console.warn("세션 연장 실패");
            }
        }).catch(err => {
            console.error("서버 연결 실패", err);
        });
    }, 5 * 60 * 1000);
</script>
</body>
<footer>
{{#Pad}}
    <a href = "https://port-0-fucking-m7oxoza4fc9682d2.sel4.cloudtype.app/Inside?id={{ID}}&Page={{.}}">{{.}} </a>
{{/Pad}}
</html>
